# 高度な機能ガイド

このガイドでは、Finance Portfolioアプリケーションに統合された高度な機能の使用方法について説明します。

## 概要

Finance Portfolioアプリケーションには、3つの強力な高度な機能が含まれています：

1. **🤖 機械学習予測** - AIを活用した株価予測
2. **⚡ リアルタイム更新** - 自動更新機能付きライブ価格追跡
3. **📰 ニュースとセンチメント分析** - マーケットニュースとAIセンチメントスコアリング

## 機械学習予測

### 概要

ML予測ページは、Random ForestとGradient Boostingモデルを使用して、以下に基づいて株価を予測します：
- テクニカル指標（RSI、MACD、ボリンジャーバンドなど）
- 過去の価格パターン
- 出来高トレンド
- 時系列特徴量

### 使用方法

1. **ML予測ページへの移動**
   - アプリを起動：`streamlit run portfolio_app_v2.py`
   - サイドバーのナビゲーションから「🤖 ML Predictions」を選択

2. **個別銘柄の予測**
   - ドロップダウンからポートフォリオ内の銘柄を選択
   - システムが自動的に：
     - 1年分の過去データを取得
     - 機械学習モデルをトレーニング
     - 今後5日間の予測を生成
   
3. **結果の表示**
   - **モデルパフォーマンス**：R²スコア、平均絶対誤差、トレーニングサイズ
   - **翌日予測**：現在の価格、予測価格、方向（上昇/下降）
   - **5日間予測**：複数日の予測を示すチャートと表
   - **特徴量の重要度**：予測に最も影響を与える要因

4. **ポートフォリオレベルの予測**
   - 「Generate Predictions for All Stocks」をクリック
   - バッチ処理の完了を待つ
   - サマリー指標を表示：
     - 強気対弱気シグナルの数
     - 平均予測リターン
     - トップパフォーマンス銘柄
   - すべての予測を表示するインタラクティブチャート

### 結果の理解

- **R²スコア**：モデルの精度（1.0 = 完璧、高いほど良い）
- **MAE**：ドル単位での平均予測誤差（低いほど良い）
- **予測リターン**：予想される価格変動率
- **方向**：「上昇」（📈）または「下降」（📉）の動き予測
- **特徴量の重要度**：どのテクニカル指標が最も重要かを表示

### 出力例

```
現在の価格：$150.25
予測価格：$153.40 (+2.10%)
方向：📈 上昇
R²スコア：0.847
```

### ヒント

- モデルは少なくとも100日間の過去データがあると最良の結果が得られます
- R²スコアが高いほど、予測の信頼性が高くなります
- 投資判断の1つの入力として予測を使用してください
- 定期的に新しいデータでモデルを再トレーニングすることを検討してください

## リアルタイム価格更新

### 概要

リアルタイム更新は、ポートフォリオ銘柄のライブ価格追跡を自動更新機能で提供します。

### 使用方法

1. **自動更新の有効化**
   - ホームページ（🏠 Home）を開く
   - サイドバーで「⚡ Enable Auto-Refresh」をチェック
   - 価格が60秒ごとに自動的に更新されます

2. **手動更新**
   - 「🔄 Refresh Now」ボタンをクリックして即座に更新
   - 待たずに価格を確認したい場合に便利

3. **リアルタイムデータの表示**
   - ホームページの「⚡ Real-time Price Updates」セクションを展開
   - すべてのポートフォリオ銘柄のライブ更新を確認：
     - 現在の価格
     - 当日の変動（$と%）
     - 当日の高値/安値
     - 出来高

### 機能

- **ライブ価格追跡**：Yahoo Financeからの現在の価格
- **変動インジケータ**：緑（上昇）/赤（下降）とパーセンテージ
- **出来高データ**：各銘柄の取引活動
- **サマリー統計**：ポートフォリオレベルの指標
  - 上昇銘柄対下降銘柄の数
  - ポートフォリオの平均変動
  - トップパフォーマンス銘柄

### 表示例

```
AAPL
現在の価格：$150.25 (+$2.15, +1.45%)
当日の高値/安値：$151.00 / $148.50
出来高：52.3M

ポートフォリオサマリー：
上昇銘柄：8/10
平均変動：+0.85%
トップパフォーマー：NVDA (+3.21%)
```

### 自動更新の動作

- 有効時は60秒ごとに更新
- サイドバーに更新回数を表示
- 更新中もユーザーのページ位置を保持
- いつでもサイドバーから無効化可能

## ニュースとセンチメント分析

### 概要

ニュースとセンチメントページは、最新のマーケットニュースを取得し、AIを使用してセンチメントを分析し、市場のムードを理解するのに役立ちます。

### 使用方法

1. **ニュースとセンチメントページへの移動**
   - サイドバーのナビゲーションから「📰 News & Sentiment」を選択

2. **ニュースフィードタブ**
   - 記事数を調整（5-30）
   - 「Fetch Latest News」をクリック
   - センチメントバッジ付きの記事を表示：
     - 🟢 ポジティブ（強気なニュース）
     - 🔴 ネガティブ（弱気なニュース）
     - ⚪ ニュートラル（情報提供）
   - 各記事は以下を表示：
     - 見出し
     - 発行元とタイムスタンプ
     - センチメントスコア
     - 完全な記事へのリンク

3. **センチメント概要タブ**
   - 銘柄あたりの記事数を選択（3-15）
   - 「Analyze Sentiment」をクリック
   - ポートフォリオ全体のセンチメント指標を表示：
     - ポジティブ/ネガティブ銘柄の数
     - 平均センチメントスコア
     - 分析された記事の総数
   - インタラクティブチャートでセンチメント分布を表示
   - 銘柄ごとの詳細を含む詳細テーブル

4. **銘柄詳細タブ**
   - ポートフォリオから特定の銘柄を選択
   - 分析する記事数を選択
   - 「Fetch & Analyze」をクリック
   - 包括的な分析を確認：
     - 総合センチメント（ポジティブ/ネガティブ/ニュートラル）
     - センチメント信頼度スコア
     - センチメント内訳を示す円グラフ
     - スコア付きの個別記事詳細

### センチメントスコアリング

- **スコア範囲**：-1.0（非常にネガティブ）から+1.0（非常にポジティブ）
- **ラベル**：
  - ポジティブ：スコア > 0.1（強気指標）
  - ネガティブ：スコア < -0.1（弱気指標）
  - ニュートラル：スコアが-0.1から0.1の間
- **信頼度**：モデルがセンチメントについてどれだけ確信しているか（0.0から1.0）

### センチメント結果の理解

**ポジティブセンチメント**（🟢）
- 強気なニュースを示す（収益の好調、新製品、ポジティブな予測）
- スコアが高いほど、ポジティブなセンチメントが強い
- 見出しの例：
  - "会社が四半期収益の記録を報告"
  - "強い製品需要で株価急騰"

**ネガティブセンチメント**（🔴）
- 弱気なニュースを示す（損失、人員削減、ネガティブな予測）
- 低い（よりネガティブな）スコアは、より強いネガティブなセンチメントを示す
- 見出しの例：
  - "会社が規制上の課題に直面"
  - "弱いガイダンスで株価下落"

**ニュートラルセンチメント**（⚪）
- 明確なポジティブ/ネガティブなトーンのない事実的/情報的ニュース
- 見出しの例：
  - "会社が年次株主総会を発表"
  - "第2四半期に新製品発売予定"

### 出力例

```
ポートフォリオセンチメント概要
===========================
ポジティブ銘柄：7/10
ネガティブ銘柄：2/10
平均スコア：+0.23
総記事数：50

AAPL - 総合センチメント
========================
センチメント：🟢 ポジティブ
平均スコア：+0.45
信頼度：0.82
分析された記事：10

内訳：
- ポジティブ：7記事
- ニュートラル：2記事
- ネガティブ：1記事
```

### センチメント分析を使用するためのヒント

1. **コンテキストが重要**：見出しだけでなく完全な記事を読む
2. **データの集約**：個別の記事ではなく全体的なセンチメントトレンドを確認
3. **信頼度スコア**：高い信頼度 = より信頼性の高いセンチメント
4. **他のデータとの組み合わせ**：価格データやテクニカル分析と並行してセンチメントを使用
5. **最新性**：公開日を確認 - 最近のニュースは通常より関連性が高い

## ポートフォリオ管理との統合

### 組み合わせた使用ワークフロー

3つの機能すべてを一緒に使用する方法：

1. **朝のルーティン**
   - ホームページで自動更新を有効化
   - リアルタイム価格の動きを確認
   - ニュースページでセンチメントを確認

2. **週次分析**
   - すべての銘柄でML予測を生成
   - 強いポジティブ予測を持つ銘柄を特定
   - センチメント分析と相互参照
   - アラインメントを探す：ポジティブな予測 + ポジティブなセンチメント

3. **投資判断**
   - 価格目標にML予測を使用
   - 市場のムードを測るためにセンチメントを使用
   - エントリー/エグジットのタイミングにリアルタイムデータを使用
   - ファンダメンタル分析と組み合わせる

### ベストプラクティス

1. **1つのシグナルに依存しない**
   - ML予測 + センチメント + テクニカル分析を使用
   - 複数のタイムフレームを考慮
   - ファンダメンタルデータで検証

2. **定期的な更新**
   - MLモデルを毎月再トレーニング
   - 保有銘柄のニュースを毎日確認
   - 取引時間中にリアルタイム価格を監視

3. **リスク管理**
   - ML予測は確率的であり、確実ではありません
   - ネガティブなセンチメントは常に売却を意味するわけではありません
   - ストップロスとポジションサイジングを使用

4. **データ品質**
   - MLに十分な過去データを確保（100日以上）
   - ニュースソースが信頼できることを確認
   - リアルタイム価格の精度を検証

## 技術詳細

### 機械学習

- **モデル**：Random Forest（プライマリ）、Gradient Boosting（代替）
- **特徴量**：15以上のテクニカル指標 + ラグ特徴量 + 時間特徴量
- **トレーニング**：80/20トレイン/テスト分割
- **検証**：MSE、MAE、R²メトリクス

### ニュースとセンチメント

- **ニュースソース**：Yahoo Finance
- **センチメント方法**：
  - キーワードベース分析（常に利用可能）
  - TextBlob NLP（オプション、精度向上）
- **更新頻度**：オンデマンド

### リアルタイム更新

- **価格ソース**：Yahoo Finance API
- **更新間隔**：60秒（設定可能）
- **データポイント**：価格、出来高、高値/安値、変動

## トラブルシューティング

### ML予測の問題

**問題**：「予測に十分なデータがありません」
- **解決策**：銘柄には少なくとも100日間の価格履歴が必要です
- **回避策**：より多くの過去データが蓄積されるのを待つ

**問題**：低いR²スコア（< 0.3）
- **解決策**：モデルがこの銘柄にうまく適合しない可能性があります
- **回避策**：より長いトレーニング期間または異なる銘柄を試す

### リアルタイム更新の問題

**問題**：価格が更新されない
- **解決策**：インターネット接続とYahoo Financeの可用性を確認
- **回避策**：手動更新ボタンを使用

**問題**：自動更新によるラグ
- **解決策**：パフォーマンスが悪い場合は自動更新を無効化
- **回避策**：代わりに手動更新を使用

### ニュースとセンチメントの問題

**問題**：「ニュース記事が見つかりません」
- **解決策**：銘柄に最近のニュース報道がない可能性があります
- **回避策**：主要なインデックスETFまたはより大きな企業を確認

**問題**：センチメントが不正確に見える
- **解決策**：キーワードベース分析には制限があります
- **回避策**：より良い精度のためにTextBlobをインストール：`pip install textblob`

## API制限とパフォーマンス

### Yahoo Financeレート制限

- APIレート制限に注意してください
- 短期間での過度なリクエストを避ける
- 可能な場合はキャッシングを使用

### パフォーマンス最適化

- MLトレーニングは銘柄あたり10-30秒かかる場合があります
- バッチ操作には数分かかる場合があります
- ニュース取得はネットワーク速度に依存します
- より速い結果のためにより少ない銘柄を分析することを検討してください

## 今後の機能強化

計画されている改善：

1. **MLモデル**
   - より良い時系列予測のためのLSTM/GRU
   - 複数のモデルを組み合わせるアンサンブル手法
   - 異常なパターンの異常検出

2. **リアルタイム**
   - プッシュ更新のためのWebSocket統合
   - 複数のデータソース
   - オーダーブックデータ

3. **センチメント**
   - 複数のニュースソース（NewsAPI、Bloomberg）
   - 高度なNLP（BERT、FinBERT）
   - ソーシャルメディアセンチメント（Twitter、Reddit）

## サポート

問題や質問がある場合：
- 既存のテストを確認：`test_ml.py`、`test_news.py`、`test_ui_advanced_features.py`
- ソースファイルのコードドキュメントを確認
- 技術詳細についてはFEATURE_IMPLEMENTATION_SUMMARY.mdを参照

## 結論

これらの高度な機能により、Finance Portfolioアプリは単純なトラッカーから包括的な投資分析プラットフォームに変わります。ML予測、リアルタイムデータ、センチメント分析を組み合わせることで、ポートフォリオと個別銘柄に関する複数の視点が得られます。

覚えておいてください：これらは判断を置き換えるのではなく、情報を提供するツールです。投資判断を行う前に、常に自分で調査し、リスク許容度を考慮してください。
